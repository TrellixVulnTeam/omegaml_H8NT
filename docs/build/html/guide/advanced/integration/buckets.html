

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Multiple environments &mdash; omega|ml 1.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../search.html"/>
    <link rel="top" title="omega|ml 1.1 documentation" href="../../../index.html"/>
        <link rel="up" title="Working with clusters" href="index.html"/>
        <link rel="next" title="Customizing omega|ml" href="../customizing/index.html"/>
        <link rel="prev" title="Runtime Clusters" href="runtimes.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> omega|ml
          

          
          </a>

          
            
            
              <div class="version">
                1.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../quickstart/index.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../getstarted.html">Getting started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../datasets/index.html">Working with datasets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/index.html">Working with models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../jobs/index.html">Working with notebooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../clusters/index.html">Working with the cloud</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Advanced features</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../scripts/index.html">Working with scripts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../streams/index.html">Working with streams</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Working with clusters</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="runtimes.html">Runtime Clusters</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Multiple environments</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../customizing/index.html">Customizing omega|ml</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../admin/index.html">Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../devguide/index.html">Development Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nb/index.html">Tutorial Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../screenshots.html">Screenshots</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">omega|ml</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">User Guide</a> &raquo;</li>
        
          <li><a href="../index.html">Advanced features</a> &raquo;</li>
        
          <li><a href="index.html">Working with clusters</a> &raquo;</li>
        
      <li>Multiple environments</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/guide/advanced/integration/buckets.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="multiple-environments">
<h1>Multiple environments<a class="headerlink" href="#multiple-environments" title="Permalink to this headline">¶</a></h1>
<p>omega|ml provides three concepts to work with multiple environments, each focussed on a specific need.</p>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">context</span></code> - a context provides a completely seperate environment, where all datasets, models,
jobs as well as the runtime is distinct from any other other context. Think of this is the equivalent
of a seperate account.</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">buckets</span></code> - a bucket is a logical subset of a context. It utilizes the same database and the
same runtime as any other bucket within the same context. Think of this a a top-level folder in
an other-wise shared environment.</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">routing</span></code> - tasks submitted to the runtime can specify resource requirements, which
effectively route tasks to different workers. Multiple contexts can use the same runtime resources.
Think of this as compute cluster segregation e.g. by client or project.</p></li>
</ul>
<div class="section" id="working-with-contexts">
<h2>Working with Contexts<a class="headerlink" href="#working-with-contexts" title="Permalink to this headline">¶</a></h2>
<p>omega|ml contexts are created by calling the <code class="code docutils literal notranslate"><span class="pre">om.setup()</span></code> function, returning a configured
<code class="code docutils literal notranslate"><span class="pre">Omega()</span></code> instance:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># development environment</span>
<span class="n">om_dev</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">mongo_url</span><span class="o">=....</span><span class="p">,</span> <span class="n">celeryconf</span><span class="o">=....</span><span class="p">)</span>
<span class="c1"># production environment</span>
<span class="n">om_prod</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">mongo_url</span><span class="o">=....</span><span class="p">,</span> <span class="n">celeryconf</span><span class="o">=....</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="working-with-buckets">
<h2>Working with Buckets<a class="headerlink" href="#working-with-buckets" title="Permalink to this headline">¶</a></h2>
<p>Each <code class="code docutils literal notranslate"><span class="pre">Omega</span></code> instance is configured to a particular bucket, the default being <code class="code docutils literal notranslate"><span class="pre">omega</span></code>. To
get an instantance configured for an other bucket use:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">om_foo</span> <span class="o">=</span> <span class="n">om</span><span class="p">[</span><span class="s1">&#39;mybucket&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Buckets are an easy built-in way to separate environments, projects and users. For example,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># an environment for user1</span>
<span class="n">om_user1</span> <span class="o">=</span> <span class="n">om</span><span class="p">[</span><span class="s1">&#39;user1&#39;</span><span class="p">]</span>
<span class="c1"># an environment for project_a</span>
<span class="n">om_prjA</span> <span class="o">=</span> <span class="n">om</span><span class="p">[</span><span class="s1">&#39;projec_a&#39;</span><span class="p">]</span>
<span class="c1"># development</span>
<span class="n">om_dev</span> <span class="o">=</span> <span class="n">om</span><span class="p">[</span><span class="s1">&#39;dev&#39;</span><span class="p">]</span>
<span class="c1"># production</span>
<span class="n">om_prod</span> <span class="o">=</span> <span class="n">om</span><span class="p">[</span><span class="s1">&#39;prod&#39;</span><span class="p">]</span>
<span class="c1"># etc.</span>
</pre></div>
</div>
</div>
<div class="section" id="promoting-objects-between-contexts-and-environments">
<h2>Promoting objects between contexts and environments<a class="headerlink" href="#promoting-objects-between-contexts-and-environments" title="Permalink to this headline">¶</a></h2>
<p>Object promotion copies objects from one context to another, more specifically from one bucket to another bucket.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Promoition is more than a simple copy: Some objects may require conditions to be met
(e.g. a model must be trained) before the promotion works. The default implementation
of object promotion does not impose any conditions and works as a copy/replace.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">om_dev</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">promote</span><span class="p">(</span><span class="s1">&#39;sales&#39;</span><span class="p">,</span> <span class="n">om_prod</span><span class="o">.</span><span class="n">datasets</span><span class="p">)</span>
<span class="n">om_dev</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">promote</span><span class="p">(</span><span class="s1">&#39;sales-prediction&#39;</span><span class="p">,</span> <span class="n">om_prod</span><span class="o">.</span><span class="n">models</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="working-with-runtime-routing">
<h2>Working with runtime routing<a class="headerlink" href="#working-with-runtime-routing" title="Permalink to this headline">¶</a></h2>
<p>When using <code class="code docutils literal notranslate"><span class="pre">om.runtime</span></code> tasks are submitted to a runtime worker. A runtime worker is any compute
node that runs an omegaml worker. Tasks are submitted by sending a message to a celery queue, by default all tasks
are routed to the :code:’default` queue. Any other queue can be specified:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># this will route the fit task to a gpu node</span>
<span class="n">om</span><span class="o">.</span><span class="n">runtime</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="s1">&#39;gpu&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="s1">&#39;mymodel&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>The same can be achieved on the command line:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ om runtime --require gpu model mymodel fit ...
</pre></div>
</div>
<p>Similarly, the runtime provides a local option which means the task is run locally. This is useful for debugging, e.g.
when running a script.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">om</span><span class="o">.</span><span class="n">runtime</span><span class="o">.</span><span class="n">mode</span><span class="p">(</span><span class="n">local</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="s1">&#39;mymodel&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>Models can be permanently bound to a particular route by specifying the queue name in the model’s metadata
attributes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># specify the .require() value as part of the metadata</span>
<span class="n">specs</span> <span class="o">=</span> <span class="p">{</span>
   <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;gpu&#39;</span>
<span class="p">}</span>
<span class="n">om</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="s1">&#39;mymodel&#39;</span><span class="p">,</span> <span class="n">attributes</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">require</span><span class="o">=</span><span class="n">specs</span><span class="p">))</span>

<span class="c1"># using the runtime will automatically apply .require(&#39;gpu&#39;)</span>
<span class="n">om</span><span class="o">.</span><span class="n">runtime</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="s1">&#39;regmodel&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../customizing/index.html" class="btn btn-neutral float-right" title="Customizing omega|ml" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="runtimes.html" class="btn btn-neutral" title="Runtime Clusters" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020 (c) omegaml.io by one2seven GmbH.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'1.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../../_static/language_data.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>